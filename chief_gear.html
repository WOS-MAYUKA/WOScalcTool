<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>領主装備コスト計算機 | WOS Tools</title>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" rel="stylesheet">

<style>
  /* --- 共通デザイン定義 --- */
  :root {
    --bg-deep: #020617;
    --glass-surface: rgba(255, 255, 255, 0.03);
    --glass-border: rgba(255, 255, 255, 0.15);
    --accent-ice: #22d3ee;
    --text-main: #f1f5f9;
    --text-sub: #94a3b8;

    /* アイテムカラー定義 */
    --col-alloy: #94a3b8; /* 強靭な合金 (銀) */
    --col-polish: #bef264; /* 研磨剤 (黄緑) */
    --col-bp: #fbbf24; /* 設計図面 (金/茶) */
    --col-amber: #f97316; /* 月光琥珀 (オレンジ) */
  }

    /* YouTube埋め込み用スタイル */
    .youtube-wrapper {
      width: 100%;
      max-width: 800px;
      margin: 40px auto;
      text-align: center;
    }
    .youtube-container {
      position: relative;
      width: 100%;
      aspect-ratio: 16 / 9; /* スマホでも16:9を維持 */
      background: #000;
      border: 1px solid #22d3ee; /* ネオン青の枠線 */
      border-radius: 12px;
      box-shadow: 0 0 15px rgba(34, 211, 238, 0.2);
      overflow: hidden;
    }
    .youtube-container iframe {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
    }
    .video-caption {
      color: #22d3ee;
      font-size: 0.9rem;
      margin-top: 10px;
      font-weight: bold;
    }
    
  html { scroll-behavior: smooth; }

  body {
    margin: 0; padding: 0;
    font-family: "Helvetica Neue", Arial, "Hiragino Kaku Gothic ProN", "Hiragino Sans", sans-serif;
    background-color: var(--bg-deep);
    color: var(--text-main);
    min-height: 100vh;
    display: flex; flex-direction: column; align-items: center;
    overflow-x: hidden;
  }

  .bg-layer {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    z-index: -2;
    background-image: url('image.png');
    background-size: cover;
    background-position: center;
    filter: brightness(0.6) contrast(1.1) blur(2px);
  }
  .bg-overlay {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    z-index: -1;
    background: radial-gradient(circle at center, transparent 0%, var(--bg-deep) 90%);
    pointer-events: none;
  }
  .snow-container {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    pointer-events: none; z-index: 0;
    background-image: url('data:image/svg+xml;base64,PHN2ZyB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgd2lkdGg9IjEwIiBoZWlnaHQ9IjEwIj48Y2lyY2xlIGN4PSI1IiBjeT0iNSIgcj0iMSIgZmlsbD0icmdiYSgyNTUsMjU1LDI1NSwwLjMpIi8+PC9zdmc+');
    animation: snow 25s linear infinite;
    opacity: 0.6;
  }
  @keyframes snow { 0% { background-position: 0 0; } 100% { background-position: 50px 500px; } }

  .container {
    position: relative; z-index: 1; width: 100%; max-width: 800px;
    padding: 40px 20px; box-sizing: border-box;
  }

  .nav-back {
    display: inline-flex; align-items: center; gap: 8px;
    color: var(--text-sub); text-decoration: none;
    margin-bottom: 30px; transition: 0.3s; font-size: 0.9rem;
  }
  .nav-back:hover { color: var(--accent-ice); transform: translateX(-5px); }

  .calc-card {
    background: var(--glass-surface);
    backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px);
    border: 1px solid var(--glass-border);
    border-radius: 12px;
    padding: 30px;
    box-shadow: 0 10px 30px -10px rgba(0,0,0,0.5);
  }

  h2 {
    text-align: center; font-size: 1.8rem; margin: 0 0 30px 0;
    color: var(--text-main); letter-spacing: 0.1em;
    text-shadow: 0 0 15px rgba(34, 211, 238, 0.3);
    border-bottom: 1px solid var(--glass-border);
    padding-bottom: 20px;
  }

  label {
    display: block; margin-top: 20px; margin-bottom: 8px;
    font-weight: 700; font-size: 0.9rem; color: var(--accent-ice);
    letter-spacing: 0.05em;
  }

  select, input {
    width: 100%; padding: 14px;
    background-color: rgba(0, 0, 0, 0.4);
    border: 1px solid var(--glass-border);
    border-radius: 8px;
    color: var(--text-main); font-size: 16px;
    box-sizing: border-box; transition: 0.3s;
  }
  select:focus, input:focus {
    border-color: var(--accent-ice); outline: none;
    box-shadow: 0 0 10px rgba(34, 211, 238, 0.2);
    background-color: rgba(0, 0, 0, 0.6);
  }

  .row-inputs {
    display: flex; gap: 15px;
  }
  .row-inputs > div { flex: 1; }

  button.calc-btn {
    width: 100%;
    background: linear-gradient(135deg, var(--accent-ice), #0ea5e9);
    color: #fff; padding: 18px; border: none; border-radius: 50px;
    font-size: 1.1rem; font-weight: bold; margin-top: 30px;
    cursor: pointer; transition: 0.3s; letter-spacing: 0.1em;
    box-shadow: 0 4px 15px rgba(34, 211, 238, 0.3);
  }
  button.calc-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(34, 211, 238, 0.5);
  }
  button.calc-btn:active { transform: scale(0.98); }

  .result-container {
    margin-top: 40px; background-color: rgba(0,0,0,0.3);
    border-radius: 12px; padding: 25px;
    border: 1px solid var(--accent-ice);
    box-shadow: inset 0 0 20px rgba(34, 211, 238, 0.05);
    animation: fadeIn 0.5s ease;
    display: none;
  }
  @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

  .result-group {
    margin-bottom: 25px;
    padding-bottom: 10px;
    border-bottom: 1px dashed rgba(255,255,255,0.2);
  }
  .result-group:last-child { margin-bottom: 0; border-bottom: none; }

  .group-header {
    font-size: 1.1rem; color: var(--accent-ice); margin-bottom: 15px;
    font-weight: bold; display: flex; align-items: center; gap: 10px;
  }
  .group-header::before {
    content: ''; display: inline-block; width: 4px; height: 16px;
    background: var(--accent-ice); border-radius: 2px;
  }

  .result-row {
    display: flex; justify-content: space-between; align-items: center;
    margin-bottom: 10px; padding-bottom: 5px;
  }

      .result-label { 
        font-size: 0.95rem; color: var(--text-sub); 
        display: flex; align-items: center; gap: 10px;
        font-weight: bold;
      }

      .result-value {
        font-size: 1.3rem; font-weight: 800; color: var(--accent-ice);
        font-family: "Helvetica Neue", sans-serif;
        text-shadow: 0 0 10px rgba(34, 211, 238, 0.3);
      }

  .icon-alloy { color: var(--col-alloy); }
  .icon-polish { color: var(--col-polish); }
  .icon-bp { color: var(--col-bp); }
  .icon-amber { color: var(--col-amber); }

  .hidden { display: none; }

      /* --- ヴァレリア入力欄用スタイル --- */
      .setting-container {
        margin-top: 20px;
        padding: 10px 15px;
        background: rgba(34, 211, 238, 0.05);
        border: 1px solid var(--glass-border);
        border-radius: 8px;
      }
      .setting-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: nowrap;
        gap: 5px;
      }
      .setting-label {
        font-weight: bold;
        color: var(--accent-ice);
        font-size: 0.8rem;
        white-space: nowrap;
        flex-shrink: 0;
      }
      .setting-input {
        flex: 1;
        display: flex;
        justify-content: flex-end;
        min-width: 0;
      }
    
  footer {
    margin-top: auto; padding: 40px; width: 100%; text-align: center;
    color: var(--text-sub); font-size: 0.8rem; letter-spacing: 0.1em;
  }

      /* トップへ戻るボタン */
      #page-top-btn {
        position: fixed; bottom: 20px; right: 20px; z-index: 100;
        width: 50px; height: 50px; background: rgba(34, 211, 238, 0.2);
        border: 1px solid var(--accent-ice); border-radius: 50%;
        color: var(--accent-ice); font-size: 1.2rem;
        display: flex; align-items: center; justify-content: center;
        cursor: pointer; opacity: 0; pointer-events: none; transition: 0.3s;
        backdrop-filter: blur(5px);
      }
      #page-top-btn.show { opacity: 1; pointer-events: auto; }
      #page-top-btn:hover { background: rgba(34, 211, 238, 0.4); transform: translateY(-3px); }

</style>
</head>
<body>

<div class="bg-layer"></div>
<div class="bg-overlay"></div>
<div class="snow-container"></div>

<div class="container">
  <a href="index.html" class="nav-back"><i class="fas fa-chevron-left"></i> トップページに戻る</a>

  <div class="calc-card">
    <h2>領主装備コスト計算機</h2>

    <div class="row-inputs">
      <div>
        <label>現在ランク</label>
        <select id="currentRank">
        </select>
        <div id="currentStageBox" class="hidden" style="margin-top: 10px;">
           <label id="curStageLabel" style="font-size:0.8rem; color:var(--text-sub);">段階</label>
           <select id="currentStage">
           </select>
        </div>
      </div>

      <div>
        <label>目標ランク</label>
        <select id="targetRank">
        </select>
        <div id="targetStageBox" class="hidden" style="margin-top: 10px;">
           <label id="tarStageLabel" style="font-size:0.8rem; color:var(--text-sub);">段階</label>
           <select id="targetStage">
           </select>
        </div>
      </div>
    </div>

      <div class="setting-container">
        <div class="setting-row">
          <span class="setting-label">
            ヴァレリア(出撃準備)
          </span>
          <div class="setting-input">
            <select id="valeriaBonus" style="width: 100%; max-width: 150px; padding: 6px; font-size: 0.8rem;">
              <option value="1.0">未解放 (0%)</option>
              <option value="1.02">Lv.1 (2%)</option>
              <option value="1.04">Lv.2 (4%)</option>
              <option value="1.06">Lv.3 (6%)</option>
              <option value="1.08">Lv.4 (8%)</option>
              <option value="1.10">Lv.5 (10%)</option>
              <option value="1.12">Lv.6 (12%)</option>
              <option value="1.14">Lv.7 (14%)</option>
              <option value="1.16">Lv.8 (16%)</option>
              <option value="1.18">Lv.9 (18%)</option>
              <option value="1.20">Lv.10 (20%)</option>
            </select>
          </div>
        </div>
      </div>
      
    <button class="calc-btn" onclick="calculateEquipCost()">必要コストを計算</button>

    <div class="result-container" id="resultArea">
        </div>

  </div>
</div>

    <div class="youtube-wrapper">
      <div class="youtube-container">
        <iframe 
          src="https://www.youtube.com/embed/iNzZ2qdIkbM?rel=0" 
          title="YouTube video player" 
          frameborder="0" 
          allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" 
          allowfullscreen>
        </iframe>
      </div>
      <p class="video-caption">▲関連動画：領主装備T4一気に強化してみた！</p>
    </div>
    
<footer>
  &copy; 2026 WOS Tools Created by MAYUKA
</footer>

      <div id="page-top-btn" onclick="window.scrollTo({top: 0, behavior: 'smooth'});">
        <i class="fas fa-chevron-up"></i>
      </div>

<script>
    // スクロール検知でボタン表示
    window.addEventListener('scroll', () => {
      const btn = document.getElementById('page-top-btn');
      if (window.scrollY > 300) btn.classList.add('show');
      else btn.classList.remove('show');
    });

// ==========================================
// データ定義 (Data Definition)
// ==========================================

    const EQUIP_DATA = [
        // --- 未解放 (Unreleased) ---
        { name: "未解放", alloy: 0, polish: 0, bp: 0, amber: 0, score: 0 },

        // --- グッド (Good) ---
        { name: "グッド", alloy: 1500, polish: 15, bp: 0, amber: 0, score: 1125 },
        { name: "グッド★1", alloy: 3800, polish: 40, bp: 0, amber: 0, score: 1875 },

        // --- レア (Rare) ---
        { name: "レア", alloy: 7000, polish: 70, bp: 0, amber: 0, score: 3000 },
        { name: "レア★1", alloy: 9700, polish: 95, bp: 0, amber: 0, score: 4500 },
        { name: "レア★2", alloy: 0, polish: 0, bp: 45, amber: 0, score: 5100 },
        { name: "レア★3", alloy: 0, polish: 0, bp: 50, amber: 0, score: 5440 },

        // --- エピック (Epic) ---
        { name: "エピック", alloy: 0, polish: 0, bp: 60, amber: 0, score: 3230 },
        { name: "エピック★1", alloy: 0, polish: 0, bp: 70, amber: 0, score: 3230 },
        { name: "エピック★2", alloy: 6500, polish: 65, bp: 40, amber: 0, score: 3225 },
        { name: "エピック★3", alloy: 8000, polish: 80, bp: 50, amber: 0, score: 3225 },

        // --- エピック T1 ---
        { name: "エピックT1", alloy: 10000, polish: 95, bp: 60, amber: 0, score: 3440 },
        { name: "エピックT1★1", alloy: 11000, polish: 110, bp: 70, amber: 0, score: 3440 },
        { name: "エピックT1★2", alloy: 13000, polish: 130, bp: 85, amber: 0, score: 4085 },
        { name: "エピックT1★3", alloy: 15000, polish: 160, bp: 100, amber: 0, score: 4085 },

        // --- レジェンド (Legend) ---
        { name: "レジェンド", alloy: 22000, polish: 220, bp: 40, amber: 0, score: 6250 },
        { name: "レジェンド★1", alloy: 23000, polish: 230, bp: 40, amber: 0, score: 6250 },
        { name: "レジェンド★2", alloy: 25000, polish: 250, bp: 45, amber: 0, score: 6250 },
        { name: "レジェンド★3", alloy: 26000, polish: 260, bp: 45, amber: 0, score: 6250 },

        // --- レジェンド T1 ---
        { name: "レジェンドT1", alloy: 28000, polish: 280, bp: 45, amber: 0, score: 6250 },
        { name: "レジェンドT1★1", alloy: 30000, polish: 300, bp: 55, amber: 0, score: 6250 },
        { name: "レジェンドT1★2", alloy: 32000, polish: 320, bp: 55, amber: 0, score: 6250 },
        { name: "レジェンドT1★3", alloy: 35000, polish: 340, bp: 55, amber: 0, score: 6250 },

        // --- レジェンド T2 ---
        { name: "レジェンドT2", alloy: 38000, polish: 390, bp: 55, amber: 0, score: 6250 },
        { name: "レジェンドT2★1", alloy: 43000, polish: 430, bp: 75, amber: 0, score: 6250 },
        { name: "レジェンドT2★2", alloy: 45000, polish: 460, bp: 80, amber: 0, score: 6250 },

        // =========================================================
        // ここから 4段階分割エリア (画像の詳細リスト部分)
        // =========================================================

        // レジェンドT2★3 -> 次は 神話
        { name: "レジェンドT2★3", alloy: 48000, polish: 500, bp: 85, amber: 0, hasStages: true, maxStage: 3, score: 2320 }, 
        { name: "レジェンドT2★3-1", alloy: 12500, polish: 132, bp: 21, amber: 2, isStage: true, score: 2320 },
        { name: "レジェンドT2★3-2", alloy: 12500, polish: 132, bp: 21, amber: 2, isStage: true, score: 2320 },
        { name: "レジェンドT2★3-3", alloy: 12500, polish: 132, bp: 21, amber: 2, isStage: true, score: 2320 },

        // 神話 -> 次は 神話★1
        { name: "神話", alloy: 12500, polish: 134, bp: 22, amber: 4, hasStages: true, maxStage: 3, score: 2600 },
        { name: "神話-1", alloy: 13000, polish: 140, bp: 22, amber: 2, isStage: true, score: 2320 },
        { name: "神話-2", alloy: 13000, polish: 140, bp: 22, amber: 2, isStage: true, score: 2320 },
        { name: "神話-3", alloy: 13000, polish: 140, bp: 22, amber: 2, isStage: true, score: 2320 },

        // 神話★1 -> 次は 神話★2
        { name: "神話★1", alloy: 13000, polish: 140, bp: 24, amber: 4, hasStages: true, maxStage: 3, score: 2600 },
        { name: "神話★1-1", alloy: 13500, polish: 147, bp: 23, amber: 2, isStage: true, score: 2310 },
        { name: "神話★1-2", alloy: 13500, polish: 147, bp: 23, amber: 2, isStage: true, score: 2310 },
        { name: "神話★1-3", alloy: 13500, polish: 147, bp: 23, amber: 2, isStage: true, score: 2310 },

        // 神話★2 -> 次は 神話★3
        { name: "神話★2", alloy: 13500, polish: 149, bp: 26, amber: 4, hasStages: true, maxStage: 3, score: 2630 },
        { name: "神話★2-1", alloy: 14000, polish: 155, bp: 25, amber: 2, isStage: true, score: 2330 },
        { name: "神話★2-2", alloy: 14000, polish: 155, bp: 25, amber: 2, isStage: true, score: 2330 },
        { name: "神話★2-3", alloy: 14000, polish: 155, bp: 25, amber: 2, isStage: true, score: 2330 },

        // 神話★3 -> 次は 神話T1
        { name: "神話★3", alloy: 14000, polish: 155, bp: 25, amber: 4, hasStages: true, maxStage: 3, score: 2570 },
        { name: "神話★3-1", alloy: 14750, polish: 167, bp: 27, amber: 3, isStage: true, score: 2300 },
        { name: "神話★3-2", alloy: 14750, polish: 167, bp: 27, amber: 3, isStage: true, score: 2300 },
        { name: "神話★3-3", alloy: 14750, polish: 167, bp: 27, amber: 3, isStage: true, score: 2300 },

        // 神話T1 -> 次は 神話T1★1
        { name: "神話T1", alloy: 14750, polish: 169, bp: 29, amber: 6, hasStages: true, maxStage: 3, score: 2660 },
        { name: "神話T1-1", alloy: 15250, polish: 175, bp: 28, amber: 3, isStage: true, score: 2300 },
        { name: "神話T1-2", alloy: 15250, polish: 175, bp: 28, amber: 3, isStage: true, score: 2300 },
        { name: "神話T1-3", alloy: 15250, polish: 175, bp: 28, amber: 3, isStage: true, score: 2300 },

        // 神話T1★1 -> 次は 神話T1★2
        { name: "神話T1★1", alloy: 15250, polish: 175, bp: 31, amber: 6, hasStages: true, maxStage: 3, score: 2660 },
        { name: "神話T1★1-1", alloy: 15750, polish: 182, bp: 30, amber: 3, isStage: true, score: 2320 },
        { name: "神話T1★1-2", alloy: 15750, polish: 182, bp: 30, amber: 3, isStage: true, score: 2320 },
        { name: "神話T1★1-3", alloy: 15750, polish: 182, bp: 30, amber: 3, isStage: true, score: 2320 },

        // 神話T1★2 -> 次は 神話T1★3
        { name: "神話T1★2", alloy: 15750, polish: 184, bp: 30, amber: 6, hasStages: true, maxStage: 3, score: 2600 },
        { name: "神話T1★2-1", alloy: 16250, polish: 190, bp: 31, amber: 3, isStage: true, score: 2320 },
        { name: "神話T1★2-2", alloy: 16250, polish: 190, bp: 31, amber: 3, isStage: true, score: 2320 },
        { name: "神話T1★2-3", alloy: 16250, polish: 190, bp: 31, amber: 3, isStage: true, score: 2320 },

        // 神話T1★3 -> 次は 神話T2
        { name: "神話T1★3", alloy: 16250, polish: 190, bp: 32, amber: 6, hasStages: true, maxStage: 3, score: 2600 },
        { name: "神話T1★3-1", alloy: 17000, polish: 202, bp: 33, amber: 5, isStage: true, score: 2370 },
        { name: "神話T1★3-2", alloy: 17000, polish: 202, bp: 33, amber: 5, isStage: true, score: 2370 },
        { name: "神話T1★3-3", alloy: 17000, polish: 202, bp: 33, amber: 5, isStage: true, score: 2370 },

        // 神話T2 -> 次は 神話T2★1
        { name: "神話T2", alloy: 17000, polish: 204, bp: 36, amber: 5, hasStages: true, maxStage: 3, score: 2450 },
        { name: "神話T2-1", alloy: 17500, polish: 210, bp: 35, amber: 5, isStage: true, score: 2390 },
        { name: "神話T2-2", alloy: 17500, polish: 210, bp: 35, amber: 5, isStage: true, score: 2390 },
        { name: "神話T2-3", alloy: 17500, polish: 210, bp: 35, amber: 5, isStage: true, score: 2390 },

        // 神話T2★1 -> 次は 神話T2★2
        { name: "神話T2★1", alloy: 17500, polish: 210, bp: 35, amber: 5, hasStages: true, maxStage: 3, score: 2390 },
        { name: "神話T2★1-1", alloy: 18000, polish: 217, bp: 36, amber: 5, isStage: true, score: 2380 },
        { name: "神話T2★1-2", alloy: 18000, polish: 217, bp: 36, amber: 5, isStage: true, score: 2380 },
        { name: "神話T2★1-3", alloy: 18000, polish: 217, bp: 36, amber: 5, isStage: true, score: 2380 },

        // 神話T2★2 -> 次は 神話T2★3
        { name: "神話T2★2", alloy: 18000, polish: 219, bp: 37, amber: 5, hasStages: true, maxStage: 3, score: 2420 },
        { name: "神話T2★2-1", alloy: 18500, polish: 225, bp: 37, amber: 5, isStage: true, score: 2380 },
        { name: "神話T2★2-2", alloy: 18500, polish: 225, bp: 37, amber: 5, isStage: true, score: 2380 },
        { name: "神話T2★2-3", alloy: 18500, polish: 225, bp: 37, amber: 5, isStage: true, score: 2380 },

        // 神話T2★3 -> 次は 神話T3
        { name: "神話T2★3", alloy: 18500, polish: 225, bp: 39, amber: 5, hasStages: true, maxStage: 3, score: 2420 },
        { name: "神話T2★3-1", alloy: 19250, polish: 237, bp: 40, amber: 6, isStage: true, score: 2370 },
        { name: "神話T2★3-2", alloy: 19250, polish: 237, bp: 40, amber: 6, isStage: true, score: 2370 },
        { name: "神話T2★3-3", alloy: 19250, polish: 237, bp: 40, amber: 6, isStage: true, score: 2370 },

        // 神話T3 -> 次は 神話T3★1
        { name: "神話T3", alloy: 19250, polish: 239, bp: 40, amber: 7, hasStages: true, maxStage: 3, score: 2450 },
        { name: "神話T3-1", alloy: 20000, polish: 247, bp: 41, amber: 6, isStage: true, score: 2360 },
        { name: "神話T3-2", alloy: 20000, polish: 247, bp: 41, amber: 6, isStage: true, score: 2360 },
        { name: "神話T3-3", alloy: 20000, polish: 247, bp: 41, amber: 6, isStage: true, score: 2360 },

        // 神話T3★1 -> 次は 神話T3★2
        { name: "神話T3★1", alloy: 20000, polish: 249, bp: 42, amber: 7, hasStages: true, maxStage: 3, score: 2480 },
        { name: "神話T3★1-1", alloy: 20750, polish: 257, bp: 42, amber: 6, isStage: true, score: 2360 },
        { name: "神話T3★1-2", alloy: 20750, polish: 257, bp: 42, amber: 6, isStage: true, score: 2360 },
        { name: "神話T3★1-3", alloy: 20750, polish: 257, bp: 42, amber: 6, isStage: true, score: 2360 },

        // 神話T3★2 -> 次は 神話T3★3
        { name: "神話T3★2", alloy: 20750, polish: 259, bp: 44, amber: 7, hasStages: true, maxStage: 3, score: 2480 },
        { name: "神話T3★2-1", alloy: 21500, polish: 267, bp: 45, amber: 6, isStage: true, score: 2370 },
        { name: "神話T3★2-2", alloy: 21500, polish: 267, bp: 45, amber: 6, isStage: true, score: 2370 },
        { name: "神話T3★2-3", alloy: 21500, polish: 267, bp: 45, amber: 6, isStage: true, score: 2370 },

        // =========================================================
        // ここから 5段階 (0-4) エリア
        // 神話T3★3 以降
        // =========================================================

        // 神話T3★3 (Base) -> 次は 神話T4
        { name: "神話T3★3", alloy: 21500, polish: 269, bp: 45, amber: 7, hasStages: true, maxStage: 4, score: 2450 },
        { name: "T3★3-1", alloy: 24000, polish: 300, bp: 50, amber: 8, isStage: true, score: 3190 },
        { name: "T3★3-2", alloy: 24000, polish: 300, bp: 50, amber: 8, isStage: true, score: 3090 },
        { name: "T3★3-3", alloy: 24000, polish: 300, bp: 50, amber: 8, isStage: true, score: 3090 },
        { name: "T3★3-4", alloy: 24000, polish: 300, bp: 50, amber: 8, isStage: true, score: 3100 },

        // 神話T4 -> 次は 神話T4★1
        { name: "神話T4", alloy: 24000, polish: 300, bp: 50, amber: 8, hasStages: true, maxStage: 4, score: 3090 },
        { name: "T4-1", alloy: 28000, polish: 330, bp: 55, amber: 8, isStage: true, score: 3020 },
        { name: "T4-2", alloy: 28000, polish: 330, bp: 55, amber: 8, isStage: true, score: 3100 },
        { name: "T4-3", alloy: 28000, polish: 330, bp: 55, amber: 8, isStage: true, score: 3090 },
        { name: "T4-4", alloy: 28000, polish: 330, bp: 55, amber: 8, isStage: true, score: 3100 },

        // 神話T4★1 -> 次は 神話T4★2
        { name: "神話T4★1", alloy: 28000, polish: 330, bp: 55, amber: 8, hasStages: true, maxStage: 4, score: 3090 },
        { name: "T4★1-1", alloy: 32000, polish: 360, bp: 60, amber: 8, isStage: true, score: 3020 },
        { name: "T4★1-2", alloy: 32000, polish: 360, bp: 60, amber: 8, isStage: true, score: 3090 },
        { name: "T4★1-3", alloy: 32000, polish: 360, bp: 60, amber: 8, isStage: true, score: 3100 },
        { name: "T4★1-4", alloy: 32000, polish: 360, bp: 60, amber: 8, isStage: true, score: 3090 },

        // 神話T4★2 -> 次は 神話T4★3
        { name: "神話T4★2", alloy: 32000, polish: 360, bp: 60, amber: 8, hasStages: true, maxStage: 4, score: 3100 },
        { name: "T4★2-1", alloy: 36000, polish: 390, bp: 65, amber: 8, isStage: true, score: 3010 },
        { name: "T4★2-2", alloy: 36000, polish: 390, bp: 65, amber: 8, isStage: true, score: 3100 },
        { name: "T4★2-3", alloy: 36000, polish: 390, bp: 65, amber: 8, isStage: true, score: 3090 },
        { name: "T4★2-4", alloy: 36000, polish: 390, bp: 65, amber: 8, isStage: true, score: 3100 },

        // 神話T4★3 (最終到達点)
        { name: "神話T4★3", alloy: 36000, polish: 390, bp: 65, amber: 8, hasStages: false, score: 3090 }
    ];

  // ==========================================
  // ロジック & 初期化 (Logic & Init)
  // ==========================================

      document.addEventListener('DOMContentLoaded', () => {
          const currSel = document.getElementById('currentRank');

          // 現在ランクの選択肢生成
          const lastIndex = EQUIP_DATA.length - 1;

          EQUIP_DATA.forEach((item, index) => {
              if (item.isStage) return; // 段階データ(isStage=true)はスキップ
              if (index === lastIndex) return; // 最大レベル(神話T4★3)をスキップ

              let op = document.createElement('option');
              op.value = index;
              op.text = item.name;
              currSel.appendChild(op);
          });

          // --- イベントリスナーの設定 ---

          // 1. 現在ランク変更時
          document.getElementById('currentRank').addEventListener('change', () => {
              updateCurrentStageList(); 
              updateTargetRankList();
          });

          // 2. 現在ステージ変更時
          document.getElementById('currentStage').addEventListener('change', () => {
              updateTargetRankList();
          });

          // 3. 目標ランク変更時
          document.getElementById('targetRank').addEventListener('change', () => {
              updateTargetStageList();
          });

          // 初回実行
          updateCurrentStageList();
          updateTargetRankList();
      });

  // --- 動的生成ロジック ---

  // 現在の段階（0 〜 Max）を生成
  function updateCurrentStageList() {
      const rankIdx = parseInt(document.getElementById('currentRank').value);
      const box = document.getElementById('currentStageBox');
      const select = document.getElementById('currentStage');
      const label = document.getElementById('curStageLabel');

      // 以前の選択値を保持
      const prevVal = parseInt(select.value) || 0;
      select.innerHTML = '';

      if (EQUIP_DATA[rankIdx] && EQUIP_DATA[rankIdx].hasStages) {
          box.classList.remove('hidden');
          const maxStage = EQUIP_DATA[rankIdx].maxStage;

          for(let i=0; i<=maxStage; i++) {
              let op = document.createElement('option');
              op.value = i;
              op.text = i;
              select.appendChild(op);
          }
          label.innerText = `段階 (0-${maxStage})`;

          // 値の復元
          if (prevVal <= maxStage) select.value = prevVal;
          else select.value = 0;

      } else {
          box.classList.add('hidden');
          // 計算用にダミー値を入れておく
          let op = document.createElement('option');
          op.value = 0;
          select.appendChild(op);
      }
  }

  // 目標ランク（条件に応じて開始位置を調整）を生成
  function updateTargetRankList() {
      const curRankIdx = parseInt(document.getElementById('currentRank').value);
      const curStageVal = parseInt(document.getElementById('currentStage').value) || 0;

      const targSel = document.getElementById('targetRank');
      const prevTarVal = parseInt(targSel.value);

      targSel.innerHTML = '';

      const minTargetIdx = 1; // グッド(idx 1)以上

      // 目標リストの開始位置を決定
      let startRankIdx = curRankIdx;

      if (EQUIP_DATA[curRankIdx]) {
          // 1. 段階がない装備(レジェンドT2★2まで) -> 常に次ランクから
          if (!EQUIP_DATA[curRankIdx].hasStages) {
              startRankIdx = curRankIdx + 1;
          } 
          // 2. 段階がある装備 -> 現在が最大段階なら次ランクから
          else {
              const maxStage = EQUIP_DATA[curRankIdx].maxStage;
              if (curStageVal >= maxStage) {
                  startRankIdx = curRankIdx + 1;
              }
          }
      }

      EQUIP_DATA.forEach((item, index) => {
          if (item.isStage) return;

          // 条件：グッド以上 かつ 計算した開始ランク以上
          if (index >= minTargetIdx && index >= startRankIdx) {
              let op = document.createElement('option');
              op.value = index;
              op.text = item.name;
              targSel.appendChild(op);
          }
      });

      // 値の復元
      if (prevTarVal >= startRankIdx) {
          targSel.value = prevTarVal;
      } else {
          if (targSel.options.length > 0) {
              targSel.selectedIndex = 0;
          }
      }

      // 目標ランクが決まったので、目標ステージを計算
      updateTargetStageList();
  }

  // 目標の段階（条件付き動的生成）
  function updateTargetStageList() {
      const curRankIdx = parseInt(document.getElementById('currentRank').value);
      const tarRankIdx = parseInt(document.getElementById('targetRank').value);

      const box = document.getElementById('targetStageBox');
      const select = document.getElementById('targetStage');
      const label = document.getElementById('tarStageLabel');

      const prevVal = parseInt(select.value) || 0;
      select.innerHTML = '';

      if (EQUIP_DATA[tarRankIdx] && EQUIP_DATA[tarRankIdx].hasStages) {
          box.classList.remove('hidden');
          const maxStage = EQUIP_DATA[tarRankIdx].maxStage;

          // 開始ステージの決定
          let startStage = 0;
          if (curRankIdx === tarRankIdx) {
              const curStage = parseInt(document.getElementById('currentStage').value) || 0;
              startStage = curStage + 1;
          }

          // ループ生成
          for(let i = startStage; i <= maxStage; i++) {
              let op = document.createElement('option');
              op.value = i;
              op.text = i;
              select.appendChild(op);
          }

          label.innerText = `段階 (${startStage}-${maxStage})`;

          // 値の復元
          if (prevVal >= startStage && prevVal <= maxStage) {
              select.value = prevVal;
          } else {
              select.value = maxStage;
          }

      } else {
          box.classList.add('hidden');
          let op = document.createElement('option');
          op.value = 0;
          select.appendChild(op);
      }
  }

      // --- 計算実行 ---
      function calculateEquipCost() {
          // 1. 開始インデックス
          const curRankIdx = parseInt(document.getElementById('currentRank').value);
          let startIdx = curRankIdx;

          if (EQUIP_DATA[curRankIdx].hasStages) {
              const stageVal = parseInt(document.getElementById('currentStage').value);
              startIdx += stageVal;
          }

          // 2. 終了インデックス
          const tarRankIdx = parseInt(document.getElementById('targetRank').value);
          let endIdx = tarRankIdx;

          if (EQUIP_DATA[tarRankIdx].hasStages) {
              const stageVal = parseInt(document.getElementById('targetStage').value);
              endIdx += stageVal;
          }

          // エラーチェック
          if (startIdx >= endIdx) {
              alert("目標ランクは現在ランクより高く設定してください");
              return;
          }

          // ヴァレリア倍率の取得
          const valeriaMult = parseFloat(document.getElementById("valeriaBonus").value) || 1.0;

          // 3. コスト積算
          let baseCost = { alloy: 0, polish: 0, bp: 0, amber: 0, score: 0 };

          for (let i = startIdx + 1; i <= endIdx; i++) {
              if (EQUIP_DATA[i]) {
                  baseCost.alloy += EQUIP_DATA[i].alloy;
                  baseCost.polish += EQUIP_DATA[i].polish;
                  baseCost.bp += EQUIP_DATA[i].bp;
                  baseCost.amber += EQUIP_DATA[i].amber;
                  baseCost.score += EQUIP_DATA[i].score || 0;
              }
          }

          // 4. 結果表示
          const resultArea = document.getElementById('resultArea');
          resultArea.innerHTML = '';

          const multipliers = [1, 2, 3, 4, 6]; 

          multipliers.forEach(m => {
              const totalAlloy = Math.ceil(baseCost.alloy * m).toLocaleString();
              const totalPolish = Math.ceil(baseCost.polish * m).toLocaleString();
              const totalBp = Math.ceil(baseCost.bp * m).toLocaleString();
              const totalAmber = Math.ceil(baseCost.amber * m).toLocaleString();

              // --- SVSポイント計算 ---
              // 評価スコア合計 × 36 × 個数 × ヴァレリア倍率 (四捨五入)
              const rawSvs = baseCost.score * 36 * m; 
              const totalSvs = Math.round(rawSvs * valeriaMult).toLocaleString();

              const showAmber = (baseCost.amber * m) > 0;

              let html = `
                  <div class="result-group">
                      <div class="group-header">${m}部位分</div>

                      <div class="result-row">
                          <span class="result-label">
                              <i class="fas fa-layer-group icon-alloy"></i> 強靭な合金
                          </span>
                          <span class="result-value">${totalAlloy}</span>
                      </div>

                      <div class="result-row">
                          <span class="result-label">
                              <i class="fas fa-flask icon-polish"></i> 研磨剤
                          </span>
                          <span class="result-value">${totalPolish}</span>
                      </div>

                      <div class="result-row">
                          <span class="result-label">
                              <i class="fas fa-scroll icon-bp"></i> 設計図面
                          </span>
                          <span class="result-value">${totalBp}</span>
                      </div>
              `;

              if (showAmber) {
                  html += `
                      <div class="result-row">
                          <span class="result-label">
                              <i class="fas fa-gem icon-amber"></i> 月光琥珀
                          </span>
                          <span class="result-value">${totalAmber}</span>
                      </div>
                  `;
              }

              html += `
                      <div class="result-row" style="margin-top:15px; border-top:none;">
                          <span class="result-label" style="color:#fbbf24;">
                              <i class="fas fa-star icon-star"></i> SVSポイント
                          </span>
                          <span class="result-value">${totalSvs}</span>
                      </div>
                  </div>
              `;

              resultArea.insertAdjacentHTML('beforeend', html);
          });

          resultArea.style.display = 'block';
      }

</script>

</body>
</html>
